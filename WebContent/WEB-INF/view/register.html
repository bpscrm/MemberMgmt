<!DOCTYPE html>
<html>

	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<title>会员注册</title>
		<link href="css/style.css" rel="stylesheet" />
		<link href="css/weui.min.css" rel="stylesheet" />
		<script src="js/jquery-3.2.1.min.js"></script>
		<script src="js/weui.min.js"></script>
		<script src="js/zepto.min.js"></script>
	</head>

	<body>

		<form id="member" method="post">
			<div class="weui-cells__title">表单</div>
			<div class="weui-cells weui-cells_form">
				<div class="weui-cell">
					<div class="weui-cell__hd"><label class="weui-label">qq</label></div>
					<div class="weui-cell__bd">
						<input name="membername" class="weui-input" type="number" pattern="[0-9]*" placeholder="请输入qq号" />
					</div>
				</div>
				<div class="weui-cell weui-cell_vcode">
					<div class="weui-cell__hd">
						<label class="weui-label">手机号</label>
					</div>
					<div class="weui-cell__bd">
						<input name="membermobile" class="weui-input" type="tel" placeholder="请输入手机号" />
					</div>
					<div class="weui-cell__ft">
						<button class="weui-vcode-btn">获取验证码</button>
					</div>
				</div>
				<div class="weui-cell">
					<div class="weui-cell__hd"><label for="" class="weui-label">生日</label></div>
					<div class="weui-cell__bd">
						<input class="weui-input" name ="birthday" type="date" value="" />
					</div>
				</div>
				<div class="weui-cell">
					<div class="weui-cell__hd"><label for="" class="weui-label">时间</label></div>
					<div class="weui-cell__bd">
						<input class="weui-input" name ="birthtime" type="datetime-local" value="" placeholder="" />
					</div>
				</div>
				<div class="weui-cell weui-cell_vcode">
					<div class="weui-cell__hd"><label class="weui-label">验证码</label></div>
					<div class="weui-cell__bd">
						<input class="weui-input" name = "pincode" type="number" placeholder="请输入验证码" />
					</div>
					<div class="weui-cell__ft">
						<img class="weui-vcode-img" src="./images/vcode.jpg" />
					</div>
				</div>
			</div>
			<div class="weui-cell weui-cell_select weui-cell_select-after">
				<div class="weui-cell__hd">
					<label for="" class="weui-label">国家/地区</label>
				</div>

				<div class="weui-cell__bd">
					<select class="weui-select" name="select2">
						<option value="1">中国</option>
						<option value="2">美国</option>
						<option value="3">英国</option>
					</select>
				</div>
			</div>
			
			<div class="page__bd page__bd_spacing">
				<div class="button-sp-area">
					<a href="javascript:setMember();" class="weui-btn weui-btn_mini weui-btn_primary">保存</a>
					<a href="javascript:history.back();" class="weui-btn weui-btn_mini weui-btn_default">返回</a>					
				</div>
				<div class="page-btn-area">
					<a class="page-btn page-btn_primary" href="javascript:getMember()">查找</a>
					<input type="hidden" id="memberid" value="1"/>
				</div>
			</div>
			<div id="searchresult">
			</div>
			<div class="weui-cells__tips">底部说明文字底部说明文字</div>
		</form>
		
		<script id="template" type="text/html">
			<div>
				<div class="weui-cell">
					<div class="weui-cell__hd">
						<label class="weui-label">姓名</label>
					</div>
					<div class="weui-cell__bd">
						<#= name #>
					</div>
				</div>
				<div class="weui-cell">
					<div class="weui-cell__hd">
						<label class="weui-label">手机号</label>
					</div>
					<div class="weui-cell__bd">
						<#= mobile #>
					</div>
				</div>
			</div>

		</script>
		<script type="text/javascript">
		$.fn.parseTemplate = function(data){ 
			var str = (this).html(); 
			var _tmplCache = {} 
			var err = ""; 
			try{ 
				var func = _tmplCache[str]; 
				if (!func){ 
					var strFunc = 
					"var p=[],print=function(){p.push.apply(p,arguments);};" + 
					"with(obj){p.push('" + 
					str.replace(/[\r\t\n]/g, " ") 
					.replace(/'(?=[^#]*#>)/g, "\t") 
					.split("'").join("\\'") 
					.split("\t").join("'") 
					.replace(/<#=(.+?)#>/g, "',$1,'") 
					.split("<#").join("');") 
					.split("#>").join("p.push('") 
					+ "');}return p.join('');";
					func = new Function("obj", strFunc); 
					_tmplCache[str] = func; 
				} 
				return func(data); 
			} catch(e){
				err = e.message; 
			} 
				return "< # ERROR: " + err.toString() + " # >"; 
			};
			
		//$(document).ready(function(){
		$.fn.serializeObject = function()    
	 		{  	   
	 		   var o = {};    
	 		   var a = this.serializeArray();    
	 		   $.each(a, function() {    
	 		       if (o[this.name]) {    
	 		           if (!o[this.name].push) {    
	 		               o[this.name] = [o[this.name]];    
	 		           }    
	 		           o[this.name].push(this.value || '');    
	 		       } else {    
	 		           o[this.name] = this.value || '';    
	 		       }    
	 		   });    
	 		   return o;    
	 	};
	 		
		function setMember(){
			
			var formdata = $('#member').serializeObject();
			alert(formdata);							
					$.ajax({  
				        type: 'post',  
				        url: 'setmember',
				        cache: false,
				        dataType : 'json',
				        data: JSON.stringify(formdata),		
				        contentType : 'application/json',
				　　　　　　   async: false,
				        success: function (data) { 	
				        	var result= JSON.stringify(data);
				        	alert('success:' + result);			        	
				        },  
				        error: function (data) { 		        	
				        	alert('failed:' + data.msg);
				        }  
				    });						
		
			}
			function getMember(){
				var memberid = document.getElementById('memberid').value;
				var params = {id: memberid};
				//alert("memeberid:" + memberid);
				$.ajax({  
			        type: 'get',  
			        url: 'getmember',
			        cache: false,
			        dataType : 'json',
			        data: params,
			　　　　　　 	contentType : 'application/json', 
			　　　　　　 	async: false,
			        success: function (data) { 	
			        	//var result= JSON.stringify(data);
			        	//alert('success:' + result);
			        	var output = $('#template').parseTemplate(data);
			        	
			        	$('#searchresult').html(output);
			        				        	
			        },  
			        error: function (data) { 		        	
			        	alert('failed:' + data.msg);
			        }  
			    });
			}
			function register() {
				//这里还需要加上校验
				var mname = document.getElementById('membername').value;
				var mmobile = document.getElementById('membermobile').value;
				var mbirthday = $('#datePicker').html();
				var mgender = $('#genderPicker').html();
				alert(mname + ';' + mmobile + ';' + mgender + ';' + mbirthday);
			}
			$('#genderPicker').on('click', function() {
				weui.picker([{
					label: '先生',
					value: '先生'
				}, {
					label: '女士',
					value: '女士'
				}], {
					onChange: function(result) {
						console.log(result);
					},
					onConfirm: function(result) {
						console.log(result);
						$('#genderPicker').html(result);

					}
				});
			});
			$('#datePicker').on('click', function() {
				weui.datePicker({
					start: 1990,
					end: new Date().getFullYear(),
					onChange: function(result) {
						console.log(result);
					},
					onConfirm: function(result) {
						$('#datePicker').html(result[0] + '/' + result[1] + '/' + result[2]);

					}
				});
			});
		//});
		</script>
		<script type="text/javascript">
			$(function() {
				var winH = $(window).height();
				var categorySpace = 10;

				$('.js_item').on('click', function() {
					var id = $(this).data('id');
					window.pageManager.go(id);
				});
				$('.js_category').on('click', function() {
					var $this = $(this),
						$inner = $this.next('.js_categoryInner'),
						$page = $this.parents('.page'),
						$parent = $(this).parent('li');
					var innerH = $inner.data('height');
					bear = $page;

					if(!innerH) {
						$inner.css('height', 'auto');
						innerH = $inner.height();
						$inner.removeAttr('style');
						$inner.data('height', innerH);
					}

					if($parent.hasClass('js_show')) {
						$parent.removeClass('js_show');
					} else {
						$parent.siblings().removeClass('js_show');

						$parent.addClass('js_show');
						if(this.offsetTop + this.offsetHeight + innerH > $page.scrollTop() + winH) {
							var scrollTop = this.offsetTop + this.offsetHeight + innerH - winH + categorySpace;

							if(scrollTop > this.offsetTop) {
								scrollTop = this.offsetTop - categorySpace;
							}

							$page.scrollTop(scrollTop);
						}
					}
				});
			});
		</script>
	</body>

</html>